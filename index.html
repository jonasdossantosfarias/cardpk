<script>
    const suits = ['♥', '♦', '♣', '♠'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let deck = [];
    let playerHand = [];
    let communityCards = [];
    let phase = 'hand';

    function initializeDeck() {
        deck = [];
        suits.forEach(suit => {
            values.forEach(value => {
                deck.push(`${value}${suit}`);
            });
        });
        renderDeck();
    }

    function renderDeck() {
        const deckElement = document.getElementById('deck');
        deckElement.innerHTML = '';
        deck.forEach(card => {
            const cardElement = document.createElement('div');
            cardElement.className = `card ${card.includes('♥') || card.includes('♦') ? 'red' : 'black'}`;
            cardElement.textContent = card;
            cardElement.addEventListener('click', () => toggleCardSelection(card, cardElement));
            deckElement.appendChild(cardElement);
        });
    }

    function toggleCardSelection(card, cardElement) {
        if (cardElement.classList.contains('selected-hand')) {
            playerHand = playerHand.filter(c => c !== card);
            cardElement.classList.remove('selected-hand');
        } else if (cardElement.classList.contains('selected-community')) {
            communityCards = communityCards.filter(c => c !== card);
            cardElement.className = `card ${card.includes('♥') || card.includes('♦') ? 'red' : 'black'}`;
        } else if (phase === 'hand' && playerHand.length < 2) {
            playerHand.push(card);
            cardElement.classList.add('selected-hand');
            if (playerHand.length === 2) phase = 'pre-flop';
        } else if (phase === 'pre-flop' && communityCards.length < 3) {
            communityCards.push(card);
            cardElement.classList.add('selected-community', 'pre-flop');
            if (communityCards.length === 3) phase = 'flop';
        } else if (phase === 'flop' && communityCards.length < 4) {
            communityCards.push(card);
            cardElement.classList.add('selected-community', 'flop');
            if (communityCards.length === 4) phase = 'river';
        } else if (phase === 'river' && communityCards.length < 5) {
            communityCards.push(card);
            cardElement.classList.add('selected-community', 'river');
        }
        updateGameState();
    }

    function checkSequence(cards) {
        // Convert card values to numbers and handle Ace as 1 and 14
        const allValues = cards.map(card => card.slice(0, -1)).map(value => {
            if (value === 'A') return 14; // Ace high
            if (value === 'K') return 13;
            if (value === 'Q') return 12;
            if (value === 'J') return 11;
            return parseInt(value);
        });

        // Add Ace as 1 for low straights (A-2-3-4-5)
        if (allValues.includes(14)) allValues.push(1);

        // Sort and remove duplicates
        const uniqueValues = [...new Set(allValues)].sort((a, b) => a - b);

        // Check for sequence of 5 consecutive numbers
        for (let i = 0; i <= uniqueValues.length - 5; i++) {
            if (uniqueValues[i + 4] - uniqueValues[i] === 4) {
                return uniqueValues.slice(i, i + 5); // Return the sequence
            }
        }

        return null;
    }

    function updateGameState() {
        const allCards = [...playerHand, ...communityCards];
        const sequence = checkSequence(allCards);

        // Update recommendation
        const recommendation = playerHand.length === 2
            ? `Mão selecionada: ${playerHand.join(', ')}`
            : 'Selecione duas cartas para sua mão.';

        // Sequence check and recommendation
        let sequenceText;
        if (sequence) {
            sequenceText = `Sequência encontrada: ${sequence.join(', ')}. `;
            if (sequence[4] === 14 && sequence[0] === 10) {
                sequenceText += 'Parabéns, você tem um Royal Flush! Vá all-in!';
            } else if (sequence[4] - sequence[0] === 4) {
                sequenceText += 'Ótima mão! Aposte forte!';
            } else {
                sequenceText += 'Mão decente, jogue com confiança.';
            }
        } else {
            sequenceText = 'Nenhuma sequência encontrada. Jogue com cautela.';
        }

        document.getElementById('recommendation').textContent = recommendation;
        document.getElementById('sequence-check').textContent = sequenceText;
    }

    function restartGame() {
        playerHand = [];
        communityCards = [];
        phase = 'hand';
        initializeDeck();
        updateGameState();
    }

    initializeDeck();
</script>
